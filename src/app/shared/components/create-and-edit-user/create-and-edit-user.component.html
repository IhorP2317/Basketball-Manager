<mat-card class="user-card">
  <mat-card-content class="user-card-content">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <h1>{{ action }} User</h1>

      <p *ngIf="errorMessage != null">{{ errorMessage }}</p>
      <div class="image-container">
        <app-avatar (handleFileChange)="handleImageFile($event)" [formControl]="form.controls.avatar"></app-avatar>
      </div>
      <mat-form-field class="full-width" appearance="outline">
        <mat-label>First name</mat-label>
        <input
          matInput
          placeholder="First name"
          formControlName="firstName"
        />

        <mat-error
          *ngIf="
             form.controls.firstName.dirty ||
              form.controls.firstName.touched
            "
        >
            <span *ngIf="form.controls.firstName.hasError('required')"
            >First name is <strong>required</strong></span
            >
          <span *ngIf="form.controls.firstName.hasError('pattern')"
          >First name can only contain letters, numbers, and spaces</span
          >
        </mat-error>
      </mat-form-field>

      <mat-form-field class="full-width" appearance="outline">
        <mat-label>Last name</mat-label>
        <input matInput placeholder="Last name" formControlName="lastName"/>

        <mat-error
          *ngIf="
              form.controls.lastName.dirty ||
               form.controls.lastName.touched
            "
        >
            <span *ngIf=" form.controls.lastName.hasError('required')"
            >Last name is <strong>required</strong></span
            >
          <span *ngIf=" form.controls.lastName.hasError('pattern')"
          >Last name can only contain letters, numbers, and spaces</span
          >
        </mat-error>
      </mat-form-field>

      <mat-form-field class="full-width" appearance="outline" *ngIf="action =='Create'">
        <mat-label>Email</mat-label>
        <input
          matInput
          placeholder="example@gmail.com"
          type="email"
          formControlName="email"
        />

        <mat-error
          *ngIf="
               form.controls.email.dirty || form.controls.email.touched
            "
        >
            <span *ngIf="form.controls.email.hasError('required')"
            >Email is <strong>required</strong></span
            >
          <span *ngIf="form.controls.email.hasError('email')"
          >Please enter a valid email</span
          >
        </mat-error>
      </mat-form-field>

      <mat-form-field class="full-width" appearance="outline" *ngIf="action =='Create'">
        <mat-label>Create password</mat-label>
        <input
          matInput
          type="password"
          placeholder="Password"
          formControlName="password"
        />

        <mat-error
          *ngIf="
              form.controls.password.dirty ||
               form.controls.password.touched
            "
        >
            <span *ngIf=" form.controls.password.hasError('required')"
            >Password is <strong>required</strong></span
            >
          <span *ngIf=" form.controls.password.hasError('pattern')"
          >Please enter a valid password</span
          >
        </mat-error>
      </mat-form-field>

      <mat-form-field class="full-width" appearance="outline" *ngIf="action =='Create'">
        <mat-label>Confirm password</mat-label>
        <input
          matInput
          [type]="hidePassword ? 'password' : 'text'"
          placeholder="Password"
          formControlName="confirmPassword"
        />
        <button
          type="button"
          mat-icon-button
          matSuffix
          (click)="hidePassword = !hidePassword"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hidePassword"
        >
          <mat-icon>{{
              hidePassword ? "visibility_off" : "visibility"
            }}
          </mat-icon>
        </button>

        <mat-error
          *ngIf="
               form.controls.confirmPassword.touched ||
              form.controls.confirmPassword.dirty
            "
        >
            <span
              *ngIf="form.controls.confirmPassword.hasError('required')"
            >
              Confirm password is <strong>required</strong>
            </span>
          <span
            *ngIf="
               form.controls.confirmPassword.hasError(
                  'passwordsMismatch'
                ) && !form.controls.confirmPassword.hasError('required')
              "
          >
              Passwords must <strong>match</strong>
            </span>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width" *ngIf="action =='Create'">
        <mat-label>Role</mat-label>
        <mat-select [formControl]="form.controls.role">
          <mat-option *ngFor="let role of roles" [value]="role.value">{{ role.value }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Balance</mat-label>
        <input matInput type="number" [formControl]="form.controls.balance" step="0.01" min="0">
        <mat-error
          *ngIf="
                    form.controls.balance?.dirty || form.controls.balance?.touched
                  "
        >
          <span *ngIf="form.controls.balance?.hasError('min')"> balance is too low</span>
        </mat-error>
      </mat-form-field>
      <div class="button-action-container">
        <button
          class="button-primary full-width"
          mat-raised-button
          type="submit"
        >
          {{ action }}
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
